# 记一次由于pre环境和prod环境代码版本不一致引起的bug
## 场景
上线之后产品提出需求更改。
需求：一个后台定时任务，会定时写库，代码修改完之后一直不生效。
## 目标
找到为啥不生效
## 行动

1. 单元测试覆盖每一行代码，确保执行没问题
2. 确定代码没问题后，尝试日志打印关键信息
3. 由于测试环境并没有数据，需要发到生产环境验证，于是我选择pre环境验证
4. 突然发现pre环境上还是一周前的版本
5. 恍然大悟，由于pre环境只连生产数据库，导致pre环境一直在刷脏数据到生产环境

总结：由于pre环境和生产环境代码版本不一致，执行定时任务时导致脏数据的产生，并覆盖了生产环境的修改，从而造成了看似代码不生效的问题。

## 结论
对于涉及到后台定时任务的功能，一定要确保pre和prod代码版本一致，否则会产生脏数据。

