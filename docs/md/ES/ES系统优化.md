## ES系统优化

### 常见的ES优化手段

#### 硬件选择

Elasticsearch严重依赖磁盘，我们可以使用读写速度快的磁盘，比如说固态硬盘，1T的固态硬盘也就几百块钱。

#### 合理设置分片数

ES索引的分片数不能后期修改，只能一开始创建的时候就设定。

ES分片不能设置的太多，可能会出现两个问题

1. 因为一个分片的底层就是一个Lucene索引，会消耗更多的资源。
2. 分片过多，多个分片在同一个节点，搜索时有可能会对单个节点造成的压力过大。

设置分片的原则

* 考虑一下 node 数量，一般一个节点有时候就是一台物理机，如果分片数过多，大大超过了节点数， 很可能会导致一个节点上存在多个分片，一旦该节点故障，即使保持了 1 个以上的副本，同样有可能 会导致数据丢失，集群无法恢复。所以， 一般都设置**分片数不超过节点数的 3 倍**。
* **控制每个分片**占用的**硬盘容量不超过 ES 的最大 JVM 的堆空间设置**（一般设置不超过 32G，参考下文 的 JVM 设置原则），因此，如果索引的总容量在 500G 左右，那分片大小在 16 个左右即可；当然， 最好同时考虑原则 1。

### ES在十亿级别数量下如何提高查询速度

* 硬件升级